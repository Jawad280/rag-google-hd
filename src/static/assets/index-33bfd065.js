import{bp as e,bq as me,br as ge,bs as xe,r as l,bt as ne,bu as _e,bv as je,bw as fe,bx as Ce,by as we,bz as ye,bA as be,bB as Se,bC as ve,bD as Te}from"./vendor-9c5496e3.js";import{S as Ne,E as Ie,a as ke,b as Le,D as Ae,c as Me}from"./fluentui-icons-c58886a5.js";import{S as _,I as Q,P as Pe,T as oe,a as Ee,B as U,b as Be,c as qe,M as Re,d as $e,L as He,e as Oe,f as V,D as Fe,g as Ve,h as ze,C as De,i as Qe,j as Ge}from"./fluentui-react-ad752538.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function o(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=o(n);fetch(n.href,a)}})();const Ue="_layout_1dkox_1",Ke="_header_1dkox_7",We="_headerContainer_1dkox_12",Je="_headerTitleContainer_1dkox_20",Xe="_headerLogo_1dkox_28",Ye="_headerTitle_1dkox_20",Ze="_headerRightText_1dkox_37",T={layout:Ue,header:Ke,headerContainer:We,headerTitleContainer:Je,headerLogo:Xe,headerTitle:Ye,headerRightText:Ze},et=()=>e.jsxs("div",{className:T.layout,children:[e.jsx("header",{className:T.header,role:"banner",children:e.jsxs("div",{className:T.headerContainer,children:[e.jsx(me,{to:"/",className:T.headerTitleContainer,children:e.jsx("h3",{className:T.headerTitle,children:"RAG on database"})}),e.jsx("h4",{className:T.headerRightText,children:"OpenAI + PostgreSQL"})]})}),e.jsx(ge,{})]}),tt="_container_ggo0d_1",st="_chatRoot_ggo0d_8",nt="_chatContainer_ggo0d_13",ot="_chatEmptyState_ggo0d_21",at="_chatEmptyStateTitle_ggo0d_31",rt="_chatEmptyStateSubtitle_ggo0d_38",it="_chatMessageStream_ggo0d_54",ct="_chatMessageGpt_ggo0d_66",lt="_chatMessageGptMinWidth_ggo0d_73",dt="_chatInput_ggo0d_78",ut="_chatAnalysisPanel_ggo0d_91",ht="_chatSettingsSeparator_ggo0d_99",pt="_loadingLogo_ggo0d_105",mt="_commandsContainer_ggo0d_109",gt="_commandButton_ggo0d_114",u={container:tt,chatRoot:st,chatContainer:nt,chatEmptyState:ot,chatEmptyStateTitle:at,chatEmptyStateSubtitle:rt,chatMessageStream:it,chatMessageGpt:ct,chatMessageGptMinWidth:lt,chatInput:dt,chatAnalysisPanel:ut,chatSettingsSeparator:ht,loadingLogo:pt,commandsContainer:mt,commandButton:gt},xt="";async function _t(t){return await fetch(`${xt}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}var w=(t=>(t.Hybrid="hybrid",t.Vectors="vectors",t.Text="text",t))(w||{});const jt="_answerContainer_1sqax_1",ft="_answerLogo_1sqax_11",Ct="_answerText_1sqax_15",wt="_selected_1sqax_34",yt="_citationLearnMore_1sqax_38",bt="_citation_1sqax_38",St="_followupQuestionsList_1sqax_60",vt="_followupQuestionLearnMore_1sqax_64",Tt="_followupQuestion_1sqax_60",Nt="_supContainer_1sqax_83",It="_retryButton_1sqax_112",kt="_loadingdots_1sqax_134",Lt="_loading_1sqax_134",f={answerContainer:jt,answerLogo:ft,answerText:Ct,selected:wt,citationLearnMore:yt,citation:bt,followupQuestionsList:St,followupQuestionLearnMore:vt,followupQuestion:Tt,supContainer:Nt,retryButton:It,loadingdots:kt,loading:Lt};function At(t,s,o){const r=[];let n=t.trim();if(s){let p=n.length;for(let d=n.length-1;d>=0&&n[d]!=="]";d--)if(n[d]==="["){p=d;break}n=n.substring(0,p)}return{answerHtml:n.split(/\[([^\]]+)\]/g).map((p,j)=>{if(j%2===0)return p;{let d;return r.indexOf(p)!==-1?d=r.indexOf(p)+1:(r.push(p),d=r.length),xe(e.jsx("a",{className:"supContainer",title:p,children:e.jsx("sup",{children:d})}))}}).join(""),citations:r}}const ae=()=>e.jsx(Ne,{primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Answer logo"}),te=({answer:t,isSelected:s,isStreaming:o,onCitationClicked:r,onThoughtProcessClicked:n,onSupportingContentClicked:a,onFollowupQuestionClicked:h,showFollowupQuestions:p})=>{const j=t.choices[0].context.followup_questions,d=t.choices[0].message.content,g=l.useMemo(()=>At(d,o),[t]),C=ne.sanitize(g.answerHtml);return e.jsxs(_,{className:`${f.answerContainer} ${s&&f.selected}`,verticalAlign:"space-between",children:[e.jsx(_.Item,{children:e.jsxs(_,{horizontal:!0,horizontalAlign:"space-between",children:[e.jsx(ae,{}),e.jsxs("div",{children:[e.jsx(Q,{style:{color:"black"},iconProps:{iconName:"Lightbulb"},title:"Show thought process",ariaLabel:"Show thought process",onClick:()=>n(),disabled:!t.choices[0].context.thoughts?.length}),e.jsx(Q,{style:{color:"black"},iconProps:{iconName:"ClipboardList"},title:"Show supporting content",ariaLabel:"Show supporting content",onClick:()=>a(),disabled:!t.choices[0].context.data_points})]})]})}),e.jsx(_.Item,{grow:!0,children:e.jsx("div",{className:f.answerText,dangerouslySetInnerHTML:{__html:C}})}),!!g.citations.length&&e.jsx(_.Item,{children:e.jsxs(_,{horizontal:!0,wrap:!0,tokens:{childrenGap:5},children:[e.jsx("span",{className:f.citationLearnMore,children:"Citations:"}),g.citations.map((m,x)=>e.jsx("a",{className:f.citation,title:m,children:`${++x}. ${m}`},x))]})}),!!j?.length&&p&&h&&e.jsx(_.Item,{children:e.jsxs(_,{horizontal:!0,wrap:!0,className:`${g.citations.length?f.followupQuestionsList:""}`,tokens:{childrenGap:6},children:[e.jsx("span",{className:f.followupQuestionLearnMore,children:"Follow-up questions:"}),j.map((m,x)=>e.jsx("a",{className:f.followupQuestion,title:m,onClick:()=>h(m),children:`${m}`},x))]})})]})},Mt=()=>{const t=_e({from:{opacity:0},to:{opacity:1}});return e.jsx(je.div,{style:{...t},children:e.jsxs(_,{className:f.answerContainer,verticalAlign:"space-between",children:[e.jsx(ae,{}),e.jsx(_.Item,{grow:!0,children:e.jsxs("p",{className:f.answerText,children:["Generating answer",e.jsx("span",{className:f.loadingdots})]})})]})})},Pt=({error:t,onRetry:s})=>e.jsxs(_,{className:f.answerContainer,verticalAlign:"space-between",children:[e.jsx(Ie,{"aria-hidden":"true","aria-label":"Error icon",primaryFill:"red"}),e.jsx(_.Item,{grow:!0,children:e.jsx("p",{className:f.answerText,children:t})}),e.jsx(Pe,{className:f.retryButton,onClick:s,text:"Retry"})]}),Et="_questionInputContainer_hiipw_1",Bt="_questionInputTextArea_hiipw_12",qt="_questionInputButtonsContainer_hiipw_17",z={questionInputContainer:Et,questionInputTextArea:Bt,questionInputButtonsContainer:qt},Rt=({onSend:t,disabled:s,placeholder:o,clearOnSend:r,initQuestion:n})=>{const[a,h]=l.useState("");l.useEffect(()=>{n&&h(n)},[n]);const p=()=>{s||!a.trim()||(t(a),r&&h(""))},j=g=>{g.key==="Enter"&&!g.shiftKey&&(g.preventDefault(),p())},d=(g,C)=>{C?C.length<=1e3&&h(C):h("")};return e.jsxs(_,{horizontal:!0,className:z.questionInputContainer,children:[e.jsx(oe,{className:z.questionInputTextArea,placeholder:o,multiline:!0,resizable:!1,borderless:!0,value:a,onChange:d,onKeyDown:j}),e.jsx("div",{className:z.questionInputButtonsContainer,children:e.jsx(Ee,{content:"Ask question button",relationship:"label",children:e.jsx(U,{size:"large",icon:e.jsx(ke,{primaryFill:"rgba(115, 118, 225, 1)"}),onClick:p})})})]})},$t="_examplesNavList_bnsga_1",Ht="_example_bnsga_1",Ot="_exampleText_bnsga_29",G={examplesNavList:$t,example:Ht,exampleText:Ot},Ft=({text:t,value:s,onClick:o})=>e.jsx("div",{className:G.example,onClick:()=>o(s),children:e.jsx("p",{className:G.exampleText,children:t})}),Vt=["Best shoe for hiking?","Climbing gear cheaper than $30?","Waterproof camping gear?"],zt=({onExampleClicked:t})=>e.jsx("ul",{className:G.examplesNavList,children:Vt.map((s,o)=>e.jsx("li",{children:e.jsx(Ft,{text:s,value:s,onClick:t})},o))}),Dt="_container_1p3pb_1",Qt="_message_1p3pb_9",se={container:Dt,message:Qt},H=({message:t})=>e.jsx("div",{className:se.container,children:e.jsx("div",{className:se.message,children:t})}),Gt="_thoughtProcess_1ooqd_1",Ut="_tList_1ooqd_8",Kt="_tListItem_1ooqd_14",Wt="_tStep_1ooqd_40",Jt="_tCodeBlock_1ooqd_47",Xt="_tProp_1ooqd_51",Yt="_citationImg_1ooqd_60",N={thoughtProcess:Gt,tList:Ut,tListItem:Kt,tStep:Wt,tCodeBlock:Jt,tProp:Xt,citationImg:Yt};function Zt(t){const s=t.split(": "),o=s[0],r=ne.sanitize(s.slice(1).join(": "));return{title:o,content:r}}const es="_supportingContentNavList_beb5d_1",ts="_supportingContentItem_beb5d_9",ss="_supportingContentItemHeader_beb5d_23",ns="_supportingContentItemText_beb5d_27",os="_supportingContentItemImage_beb5d_32",q={supportingContentNavList:es,supportingContentItem:ts,supportingContentItemHeader:ss,supportingContentItemText:ns,supportingContentItemImage:os},as=({supportingContent:t})=>{const s=Array.isArray(t)?t:t.text,o=Array.isArray(t)?[]:t?.images;return e.jsxs("ul",{className:q.supportingContentNavList,children:[s.map((r,n)=>{const a=Zt(r);return e.jsxs("li",{className:q.supportingContentItem,children:[e.jsx("h4",{className:q.supportingContentItemHeader,children:a.title}),e.jsx("p",{className:q.supportingContentItemText,dangerouslySetInnerHTML:{__html:a.content}})]},n)}),o?.map((r,n)=>e.jsx("img",{className:q.supportingContentItemImage,src:r.url},n))]})};var b=(t=>(t.ThoughtProcessTab="thoughtProcess",t.SupportingContentTab="supportingContent",t.CitationTab="citation",t))(b||{});const rs=({thoughts:t})=>e.jsx("ul",{className:N.tList,children:t.map((s,o)=>e.jsxs("li",{className:N.tListItem,children:[e.jsx("div",{className:N.tStep,children:s.title}),e.jsx(_,{horizontal:!0,tokens:{childrenGap:5},children:s.props&&(Object.keys(s.props)||[]).map(r=>e.jsxs("span",{className:N.tProp,children:[r,": ",JSON.stringify(s.props?.[r])]}))}),Array.isArray(s.description)?e.jsx(fe,{language:"json",wrapLongLines:!0,className:N.tCodeBlock,children:JSON.stringify(s.description,null,2)}):e.jsx("div",{children:s.description})]},o))}),is="_downloadButton_1o536_1",cs="_markdownViewer_1o536_6",ls="_loading_1o536_15",ds="_error_1o536_21",us="_markdown_1o536_6",S={downloadButton:is,markdownViewer:cs,loading:ls,error:ds,markdown:us},hs=({src:t})=>{const[s,o]=l.useState(""),[r,n]=l.useState(!0),[a,h]=l.useState(null),p=j=>{const d=/<a\s+(?:[^>]*?\s+)?href=['"](#[^"']*?)['"][^>]*?>/g;return j.replace(d,"")};return l.useEffect(()=>{(async()=>{try{const d=await fetch(t);if(!d.ok)throw new Error("Failed loading markdown file.");const g=await d.text(),C=await Ce.parse(g),m=p(C);o(m)}catch(d){h(d)}finally{n(!1)}})()},[t]),e.jsx("div",{children:r?e.jsx("div",{className:`${S.loading} ${S.markdownViewer}`,children:e.jsx(Be,{size:qe.large,label:"Loading file"})}):a?e.jsx("div",{className:`${S.error} ${S.markdownViewer}`,children:e.jsxs(Re,{messageBarType:$e.error,isMultiline:!1,children:[a.message,e.jsx(He,{href:t,download:!0,children:"Download the file"})]})}):e.jsxs("div",{children:[e.jsx(Q,{className:S.downloadButton,style:{color:"black"},iconProps:{iconName:"Save"},title:"Save",ariaLabel:"Save",href:t,download:!0}),e.jsx("div",{className:`${S.markdown} ${S.markdownViewer}`,dangerouslySetInnerHTML:{__html:s}})]})})},D={disabled:!0,style:{color:"grey"}},ps=({answer:t,activeTab:s,activeCitation:o,citationHeight:r,className:n,onActiveTabChanged:a})=>{const h=!t.choices[0].context.thoughts,p=!t.choices[0].context.data_points,j=!o,[d,g]=l.useState(""),C=async()=>{if(o){const x=o.indexOf("#")?o.split("#")[1]:"",k=await(await fetch(o,{method:"GET"})).blob();let L=URL.createObjectURL(k);x&&(L+="#"+x),g(L)}};l.useEffect(()=>{C()},[]);const m=()=>{if(!o)return null;switch(o.split(".").pop()?.toLowerCase()){case"png":return e.jsx("img",{src:d,className:N.citationImg,alt:"Citation Image"});case"md":return e.jsx(hs,{src:o});default:return e.jsx("iframe",{title:"Citation",src:d,width:"100%",height:r})}};return e.jsxs(Oe,{className:n,selectedKey:s,onLinkClick:x=>x&&a(x.props.itemKey),children:[e.jsx(V,{itemKey:b.ThoughtProcessTab,headerText:"Thought process",headerButtonProps:h?D:void 0,children:e.jsx(rs,{thoughts:t.choices[0].context.thoughts||[]})}),e.jsx(V,{itemKey:b.SupportingContentTab,headerText:"Supporting content",headerButtonProps:p?D:void 0,children:e.jsx(as,{supportingContent:t.choices[0].context.data_points})}),e.jsx(V,{itemKey:b.CitationTab,headerText:"Citation",headerButtonProps:j?D:void 0,children:m()})]})},ms="_container_cfwv2_1",gs={container:ms},xs=({className:t,onClick:s})=>e.jsx("div",{className:`${gs.container} ${t??""}`,children:e.jsx(U,{icon:e.jsx(Le,{}),onClick:s,children:"Developer settings"})}),_s="_container_cfwv2_1",js={container:_s},fs=({className:t,disabled:s,onClick:o})=>e.jsx("div",{className:`${js.container} ${t??""}`,children:e.jsx(U,{icon:e.jsx(Ae,{}),disabled:s,onClick:o,children:"Clear chat"})}),Cs="_container_1pzrp_1",ws={container:Cs},ys=({updateRetrievalMode:t})=>{const[s,o]=l.useState(w.Hybrid),r=(n,a)=>{o(a?.data||w.Hybrid),t(a?.data||w.Hybrid)};return e.jsx(_,{className:ws.container,tokens:{childrenGap:10},children:e.jsx(Fe,{label:"Retrieval mode",options:[{key:"hybrid",text:"Vectors + Text (Hybrid)",selected:s==w.Hybrid,data:w.Hybrid},{key:"vectors",text:"Vectors",selected:s==w.Vectors,data:w.Vectors},{key:"text",text:"Text",selected:s==w.Text,data:w.Text}],required:!0,onChange:r})})},bs=()=>{const[t,s]=l.useState(!1),[o,r]=l.useState(""),[n,a]=l.useState(.3),[h,p]=l.useState(3),[j,d]=l.useState(w.Hybrid),[g,C]=l.useState(!0),m=l.useRef(""),x=l.useRef(null),[I,k]=l.useState(!1),[L,re]=l.useState(!1),[R,O]=l.useState(),[K,F]=l.useState(),[A,v]=l.useState(void 0),[M,W]=l.useState(0),[P,J]=l.useState([]),[X,ie]=l.useState([]),E=async i=>{m.current=i,R&&O(void 0),k(!0),F(void 0),v(void 0);try{const y={messages:[...P.flatMap(ee=>[{content:ee[0],role:"user"},{content:ee[1].choices[0].message.content,role:"assistant"}]),{content:i,role:"user"}],context:{overrides:{use_advanced_flow:g,top:h,retrieval_mode:j,prompt_template:o.length===0?void 0:o,temperature:n}}},$=await _t(y);if(!$.body)throw Error("No response body");const Z=await $.json();if($.status>299||!$.ok)throw Error(Z.error||"Unknown error");J([...P,[i,Z]])}catch(c){O(c)}finally{k(!1)}},ce=()=>{m.current="",R&&O(void 0),F(void 0),v(void 0),J([]),ie([]),k(!1),re(!1)};l.useEffect(()=>x.current?.scrollIntoView({behavior:"smooth"}),[I]),l.useEffect(()=>x.current?.scrollIntoView({behavior:"auto"}),[X]);const le=(i,c)=>{r(c||"")},de=(i,c,y)=>{a(i)},ue=(i,c)=>{p(parseInt(c||"3"))},he=(i,c)=>{C(!!c)},pe=i=>{E(i)},Y=(i,c)=>{K===i&&A===b.CitationTab&&M===c?v(void 0):(F(i),v(b.CitationTab)),W(c)},B=(i,c)=>{v(A===i&&M===c?void 0:i),W(c)};return e.jsxs("div",{className:u.container,children:[e.jsxs("div",{className:u.commandsContainer,children:[e.jsx(fs,{className:u.commandButton,onClick:ce,disabled:!m.current||I}),e.jsx(xs,{className:u.commandButton,onClick:()=>s(!t)})]}),e.jsxs("div",{className:u.chatRoot,children:[e.jsxs("div",{className:u.chatContainer,children:[m.current?e.jsxs("div",{className:u.chatMessageStream,children:[L&&X.map((i,c)=>e.jsxs("div",{children:[e.jsx(H,{message:i[0]}),e.jsx("div",{className:u.chatMessageGpt,children:e.jsx(te,{isStreaming:!0,answer:i[1],isSelected:!1,onCitationClicked:y=>Y(y,c),onThoughtProcessClicked:()=>B(b.ThoughtProcessTab,c),onSupportingContentClicked:()=>B(b.SupportingContentTab,c),onFollowupQuestionClicked:y=>E(y)},c)})]},c)),!L&&P.map((i,c)=>e.jsxs("div",{children:[e.jsx(H,{message:i[0]}),e.jsx("div",{className:u.chatMessageGpt,children:e.jsx(te,{isStreaming:!1,answer:i[1],isSelected:M===c&&A!==void 0,onCitationClicked:y=>Y(y,c),onThoughtProcessClicked:()=>B(b.ThoughtProcessTab,c),onSupportingContentClicked:()=>B(b.SupportingContentTab,c),onFollowupQuestionClicked:y=>E(y)},c)})]},c)),I&&e.jsxs(e.Fragment,{children:[e.jsx(H,{message:m.current}),e.jsx("div",{className:u.chatMessageGptMinWidth,children:e.jsx(Mt,{})})]}),R?e.jsxs(e.Fragment,{children:[e.jsx(H,{message:m.current}),e.jsx("div",{className:u.chatMessageGptMinWidth,children:e.jsx(Pt,{error:R.toString(),onRetry:()=>E(m.current)})})]}):null,e.jsx("div",{ref:x})]}):e.jsxs("div",{className:u.chatEmptyState,children:[e.jsx(Me,{fontSize:"120px",primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Chat logo"}),e.jsx("h1",{className:u.chatEmptyStateTitle,children:"Product chat"}),e.jsx("h2",{className:u.chatEmptyStateSubtitle,children:"Ask anything or try an example"}),e.jsx(zt,{onExampleClicked:pe})]}),e.jsx("div",{className:u.chatInput,children:e.jsx(Rt,{clearOnSend:!0,placeholder:"Type a new question (e.g. does my plan cover annual eye exams?)",disabled:I,onSend:i=>E(i)})})]}),P.length>0&&A&&e.jsx(ps,{className:u.chatAnalysisPanel,activeCitation:K,onActiveTabChanged:i=>B(i,M),citationHeight:"810px",answer:P[M][1],activeTab:A}),e.jsxs(Ve,{headerText:"Configure answer generation",isOpen:t,isBlocking:!1,onDismiss:()=>s(!1),closeButtonAriaLabel:"Close",onRenderFooterContent:()=>e.jsx(ze,{onClick:()=>s(!1),children:"Close"}),isFooterAtBottom:!0,children:[e.jsx(De,{className:u.chatSettingsSeparator,checked:g,label:"Use advanced flow with query rewriting and filter formulation. Not compatible with Ollama models.",onChange:he}),e.jsx("h3",{children:"Settings for database search:"}),e.jsx(Qe,{className:u.chatSettingsSeparator,label:"Retrieve this many matching rows:",min:1,max:50,defaultValue:h.toString(),onChange:ue}),e.jsx(ys,{updateRetrievalMode:i=>d(i)}),e.jsx("h3",{children:"Settings for final chat completion:"}),e.jsx(oe,{className:u.chatSettingsSeparator,defaultValue:o,label:"Override prompt template",multiline:!0,autoAdjustHeight:!0,onChange:le}),e.jsx(Ge,{className:u.chatSettingsSeparator,label:"Temperature",min:0,max:1,step:.1,defaultValue:n,onChange:de,showValue:!0,snapToStep:!0})]})]})]})};var Ss=e.jsx(et,{});we();const vs=ye([{path:"/",element:Ss,children:[{index:!0,element:e.jsx(bs,{})},{path:"*",lazy:()=>Te(()=>import("./NoPage-0376421b.js"),["assets/NoPage-0376421b.js","assets/vendor-9c5496e3.js"])}]}]);be.createRoot(document.getElementById("root")).render(e.jsx(Se.StrictMode,{children:e.jsx(ve,{router:vs})}));
//# sourceMappingURL=index-33bfd065.js.map
